# MVP 实施计划（更新版）

> 说明：以下计划结合目前已完成的工作（采集 / 存储 / 调度 / API），列出后续迭代要点。Task.md 中的历史任务不做调整，仅在本文件维护最新的执行路线。

## 1. 已交付的基础能力
- [x] LME / SHFE 采集脚本（实时、日线）；
- [x] sqlite 数据存储层（实时快照、日线数据、清理策略）；
- [x] 调度器（`--once` 调试 / 常驻采集 / 一键启动脚本 `run_all.py`）；
- [x] FastAPI 服务（健康检查、实时 / 日线接口、内置 Swagger 静态资源）。

## 2. 最近两周优先事项

| 优先级 | 任务 | 说明 |
| --- | --- | --- |
| P0 | 整合监控 / 日志告警 | 明确采集失败、API 异常日志输出位置，评估是否需要简单推送（邮件/钉钉）。 |
| P0 | 前端大屏原型 | 先实现最小展示（顶部概览 + 实时卡片 + 数据时间），与 API 对接。 |
| P1 | 数据校验与测试 | 为采集桥接、仓储接口补充单元测试；提供 smoke test 脚本说明。 |
| P1 | Docker Compose | 编写 scheduler + API 的 docker-compose，便于团队间快速部署。 |
| P2 | 指标派生 | 规划价差、波动率等计算逻辑，明确是在调度层离线写库还是 API 层实时计算。 |

## 3. 里程碑拆分

### M1：前端连通 & 基本监控
- 目标：大屏原型可展示实时数据，采集异常能在日志中快速定位。
- 关键任务：
  - 完成 API 调用封装、页面轮询逻辑；
  - 增加日志滚动切片与定位文档；
  - `README` 补充调试 / 排查指引。

### M2：部署自动化 & 数据保障
- 目标：提供一键启动（本地 / Docker）说明，确保数据质量。
- 关键任务：
  - docker-compose & 简易部署脚本；
  - 单元测试覆盖采集桥接 / 仓储；
  - 验证 sqlite -> PostgreSQL 迁移流程，并记录文档。

### M3：AI 报告与指标扩展
- 目标：具备生成日报的基础能力；补充价差、趋势等辅助指标。
- 关键任务：
  - 定义日报模板，梳理所需字段；
  - 设计指标派生表或 API；
  - 预留 AI 调用接口（可先对接伪数据）。

## 4. 风险与注意事项
- **采集接口稳定性**：AkShare 偶有限流，需要优先完善重试、超时策略，并考虑缓存最后一次成功数据。
- **数据库迁移**：未来切换 PostgreSQL 时，要提前规划建表 SQL、数据导入脚本；当前代码已支持读取 `DATABASE_URL`，需在文档中明确步骤。
- **团队协作**：推荐在 README 中列出常见操作（创建虚拟环境、一键启动、查看 Swagger、运行测试），减少口头重复说明。

## 5. 文档维护建议
- `README.md`：面向开发者的快速指南（已有内容需随改动及时更新）。
- `docs/design/pr.md`：保持架构与模块描述最新（本次已更新）。
- `docs/design/storage.md`：用于详细说明数据表结构、字段含义、迁移注意点；后续补充新的字段或指标时及时同步。
- `docs/design/mvp-plan.md`：即本文，仅跟踪整体里程碑，不记录每日任务（继续沿用 Task.md）。

> 若计划有变化，优先更新本文件与 `README`，确保开发成员都能获取最新信息。
