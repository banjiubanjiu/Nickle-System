# MVP 前端需求规格

面向 Nickel-System 的前端从设计到实现的高层计划，用于指导 MVP 阶段的落地与协作。该文档会随着需求澄清与实现推进迭代更新。

## 1 ：目标与核心流程
目标用户已定位为券商及期货专业人员，展示终端锁定浏览器大屏；成功指标暂不设硬性指标，将在落地过程中结合反馈再评估。核心业务闭环会在阶段 3 线框设计时同步沉淀。

## 2：API 契约梳理

**基础信息**
- 基础地址：`http://127.0.0.1:8000`（开发期），前端需通过 `.env` 可配置。
- 鉴权：当前无登录/权限控制；所有接口匿名可访问。
- 通用响应：`{ data, meta, error }`，其中 `error` 为字符串或 `null`。
- 错误处理：数据不存在时返回 `404 + {"detail": "..."}`；参数非法由 FastAPI 自动返回 `422`。
- CORS：已允许 `http://localhost:5173`、`http://127.0.0.1:5173`。

**数据模型**
- `IntradaySnapshot`：即时报价快照，核心字段（必填）`exchange`、`contract`、`captured_at`，其余数值字段均可为空。
- `DailyRecord`：日线数据，核心字段（必填）`exchange`、`contract`、`trade_date`。
- 标签字典：`meta.labels` 提供字段→中文列名映射。

**接口清单**

- `GET /health`
  - 功能：返回服务状态，含最近一次 LME 抓取时间、采集间隔、数据保留时长。
  - 用途：前端健康检查、轮询间隔（`intraday_interval_seconds`）。
- `GET /api/v1/dashboard/latest`
  - 参数：`exchange`（默认 `lme`）。
  - 返回：单条 `IntradaySnapshot`；若无数据返回 404。
- `GET /api/v1/dashboard/intraday`
  - 参数：`exchange`（默认 `lme`）、`limit`（1–500，默认 30）。
  - 返回：`IntradaySnapshot[]`，按最新→最旧排序；`meta.count` 表示返回条数。
- `GET /api/v1/dashboard/daily`
  - 参数：`exchange`（默认 `lme`）、`start_date`、`end_date`（`YYYY-MM-DD`，可为空）。
  - 返回：`DailyRecord[]`，按日期逆序；`meta` 附带筛选条件。

**字段说明（节选）**（完整定义参见 `backend/src/api/models.py`）
- `latest_price/open/high/low/close/settlement`：浮点数，若缺失返回 `null`。
- `change`：涨跌额；`change_pct`：涨跌幅百分比（原始值即百分数）。
- `elapsed_seconds`：从采集开始到当前条目的耗时（秒）。
- `tick_time`（Intraday）：原始行情时间戳字符串。

- 分页：`intraday` 通过 `limit` 控制，`daily` 当前无分页；已决定 MVP 先展示最近 N 条并在前端提供轻量列表视图（表格与图表结合），后续再评估是否需要后端分页或虚拟滚动。

**补充：**

- 交易所枚举：当前确认 MVP 仅覆盖 `lme` / `shfe`，后续如扩展需同步更新接口与前端枚举。
- 日期格式：FastAPI 接受字符串，前端需按 ISO（yyyy-mm-dd）传参。
- SSE：后端暂无推送接口，MVP 采用基于 `/health.intraday_interval_seconds` 的轮询刷新；视后续需求再升级为 SSE。

## 3 : 设计风格需求

### 整体风格
- **风格定位**：深色金融大屏，强调数据可读性与科技感。
- **设计语言**：深色玻璃拟态 + 轻量霓虹光效，卡片 hover 时出现发光和轻微浮动。
- **视觉层次**：标题区域吸顶固定，主体以模块化卡片呈现，重要数值使用高亮文字，辅助信息降低透明度。

### 色彩系统
- **背景**：`#0F1729` 基底配合径向渐变（`rgba(17,25,40,0.85)` → `rgba(15,23,41,1)`），保持沉稳夜盘氛围。
- **卡片背景**：`rgba(21,31,53,0.8)`，辅以浅色边框 `rgba(255,255,255,0.08)` 和外阴影；指标卡使用线性渐变（24,34,52 → 16,24,42）。
- **文字颜色**：
  - 主标题 / 核心数值：`rgb(109,209,246)` 或纯白。
  - 普通文字：`rgba(232,242,255,0.85)`。
  - 辅助文字：`rgba(232,242,255,0.7)`。
- **语义色**：上涨 `#FF6B6B`，下跌 `#4ECDC4`，强调色 `#00D4FF`，Link/按钮 `#00F2FF`。

### 字体与排版
- **字体栈**：`"Segoe UI", -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif`。
- **字号层级**：
  - 顶部标题 28px（随 header 压缩调整）。
  - 区块标题 22px。
  - 关键数值 40px。
  - 正文 16px，标签/单位 14-17px。
- **字重**：标题 600，数值 600-700，说明文字 400。

### 信息架构
- **顶部吸顶栏**：包含品牌 Logo、页面标题、交易所与合约下拉框。
- **指标区**：四个指标卡组成的自适应网格（`grid cols-4`）。
- **主面板**：左侧 K 线卡、右侧盘口卡（`panels` 两列布局）。
- **辅助图表区**：价格走势图 + 成交量/持仓量双卡（`grid cols-2`）。
- **统计卡片**：四宫格展示开盘价/最高价等。
- **成交表格**：底部滚动表 + hover 发光行。
- **页脚**：居中显示数据更新时间和“实时行情”链接。

### 卡片与组件设计
- **卡片**：16px 圆角、20-24px 内边距、阴影 `0 12px 40px rgba(0,0,0,0.35)`；hover 时描边亮起（`rgba(0,212,255,0.6)`）并上浮 3px。
- **指标卡**：标题居上、数值居中，下方可显示涨跌箭头；背景为渐变玻璃效果。
- **Header Logo**：24px SVG 折线置于 32px 渐变圆角背景中，与标题保持 20px 间距。
- **下拉选择**：`header-select` 采用半透明背景、上下分层标签（12px Label + 16px 正文），后续将替换为真实交互。
- **表格**：表头固定、行 hover 发光（蓝色轮廓 + 半透明底），保持当前实现的高亮风格。

### 图表样式
- **K 线**：使用 Lightweight Charts；红涨绿跌、背景透明，Y 轴刻度减少密度，右上角单位随交易所切换（`元/吨` 或 `USD/吨`）。
- **面积图**：Recharts + `#00D4FF` 渐变填充，网格线 `rgba(255,255,255,0.08)` 虚线。
- **成交量柱图**：Recharts 柱状堆叠，颜色分别为 `#00D4FF` / `#4ECDC4`，圆角顶端。

### 交互与反馈
- **Hover 光效**：指标卡、统计卡、表格行均在 Hover 时触发蓝色光晕与上浮。
- **Table 行**：使用伪元素生成发光描边，表头 `position: sticky`，保证滚动时不被遮挡。
- **下拉切换**：交易所与合约下拉互联，切换后数据立即刷新并保持右侧实时信息一致。
- **滚动行为**：顶部 header 使用 `position: sticky` 固定，底部 footer 增加 32px 顶部外边距，确保留白。

### 适配与后续计划
- 当前布局针对桌面端 1440px+，后续需新增断点策略（计划中）。
- a11y：现已保证字体≥14px，后续补充键盘焦点、对比度审核（计划中）。
- 动画：已实现 hover/发光过渡，数据更新动画待 API 接入后再评估。
- **成交量**：柱状图使用半透明渐变
- **趋势线**：平滑曲线，支持多数据系列对比

### 可访问性要求
- **对比度**：所有文字与背景对比度达到WCAG AA标准
- **字体大小**：不小于12px，重要信息不小于14px
- **焦点状态**：键盘可访问，焦点明显可见
- **色盲友好**：不仅依赖颜色传达信息，配合图标或文字

## 4:技术选型
- **前端框架**：React 18 + Hooks + Vite（已使用）。
- **语言与类型系统**：TypeScript（已使用）。
- **样式层**：原生 CSS + 设计 Token（已使用部分）。目前用全局 CSS 变量与自定义类，后续计划引入 PostCSS/自动前缀器并沉淀成统一的设计 token（计划中）。
- **状态管理**：React 本地状态 + `useMemo`/`useState`（已使用）；对接后端后计划接入 TanStack Query 管理服务端数据缓存、请求重试与错误态（计划引入，便于轮询和多接口共享数据）。
- **图表库**：Lightweight Charts（K 线，已使用）+ Recharts（面积/柱状，已使用）。
- **HTTP 客户端**：浏览器原生 `fetch`（当前尚未发起请求）；与后端联调时计划统一使用 Axios，利用拦截器做鉴权、错误提示与超时处理（计划引入，理由：便于全局配置与一致化响应封装）。
- **路由**：目前单页，无显式路由；随着页面增多，会引入 React Router v7 进行模块化导航与权限守卫（计划引入）。
- **国际化**：当前仅中文静态文案；为满足后续多语言需求，计划使用 `react-i18next` 构建翻译资源、时间/数字本地化（计划引入，理由：文档丰富、与 React 生态兼容）。
- **包管理与构建脚本**：npm + Vite（已使用）。若团队需要复用缓存/提升速度，可迁移至 pnpm（计划评估）。
- **工程质量**：TypeScript 编译校验已启用
