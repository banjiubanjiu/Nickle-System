# MVP 前端工作计划（v0.1 草案）

面向 Nickel-System 的前端从设计到实现的高层计划，用于指导 MVP 阶段的落地与协作。该文档会随着需求澄清与实现推进迭代更新。

## 阶段与产出（里程碑）
1) 目标与核心流程
- 明确用户角色、首要用例（前三个闭环）、成功指标、设备范围。
- 产出：目标陈述、核心用例列表、成功指标草案。

2) API 契约梳理
- 盘点后端接口、数据模型、鉴权机制、错误约定（码值→提示）。
- 产出：接口清单（路径/方法/参数/返回/示例）、实体模型定义。

3) 信息架构与线框
- 站点地图、导航结构、端到端用户流程线框（低保真）。
- 产出：Sitemap、关键页面线框（列表/详情/表单/仪表盘）。

4) 设计系统与样式
- 设计令牌：色彩/字号/间距/圆角/阴影、语义色、暗色可选。
- 产出：Token 表、组件规范（按钮/表单/表格/弹窗/通知等）。

5) 技术栈与脚手架
- 选择框架、UI 库、状态管理与数据层、代码规范、CI/CD。
- 产出：初始化仓库、基础依赖、项目结构、脚本、CI 配置。

6) 组件与状态规划
- 组件分层、路由与守卫、服务端状态与缓存策略、本地状态。
- 产出：组件清单、路由表、数据访问封装规范、错误/加载/空状态方案。

7) MVP 页面实现与联调
- 优先完成核心闭环（登录→核心任务→结果/反馈），对齐接口。
- 产出：可运行的核心页面、与后端打通的关键交互。

8) 质量保障
- 响应式适配、可访问性、性能预算、异常路径覆盖。
- 产出：适配断点规则、a11y 清单、性能基线报告、测试用例（必要）。

9) 发布与文档
- 环境配置、部署方案、使用说明、监控与告警接入（最小集）。
- 产出：部署脚本/说明、环境变量清单、运行手册、故障应对指引。

## 阶段 1 ：目标与核心流程
目标用户已定位为券商及期货专业人员，展示终端锁定浏览器大屏；成功指标暂不设硬性指标，将在落地过程中结合反馈再评估。核心业务闭环会在阶段 3 线框设计时同步沉淀。

## 阶段 2：API 契约梳理

**基础信息**
- 基础地址：`http://127.0.0.1:8000`（开发期），前端需通过 `.env` 可配置。
- 鉴权：当前无登录/权限控制；所有接口匿名可访问。
- 通用响应：`{ data, meta, error }`，其中 `error` 为字符串或 `null`。
- 错误处理：数据不存在时返回 `404 + {"detail": "..."}`；参数非法由 FastAPI 自动返回 `422`。
- CORS：已允许 `http://localhost:5173`、`http://127.0.0.1:5173`。

**数据模型**
- `IntradaySnapshot`：即时报价快照，核心字段（必填）`exchange`、`contract`、`captured_at`，其余数值字段均可为空。
- `DailyRecord`：日线数据，核心字段（必填）`exchange`、`contract`、`trade_date`。
- 标签字典：`meta.labels` 提供字段→中文列名映射。

**接口清单**

- `GET /health`
  - 功能：返回服务状态，含最近一次 LME 抓取时间、采集间隔、数据保留时长。
  - 用途：前端健康检查、轮询间隔（`intraday_interval_seconds`）。
- `GET /api/v1/dashboard/latest`
  - 参数：`exchange`（默认 `lme`）。
  - 返回：单条 `IntradaySnapshot`；若无数据返回 404。
- `GET /api/v1/dashboard/intraday`
  - 参数：`exchange`（默认 `lme`）、`limit`（1–500，默认 30）。
  - 返回：`IntradaySnapshot[]`，按最新→最旧排序；`meta.count` 表示返回条数。
- `GET /api/v1/dashboard/daily`
  - 参数：`exchange`（默认 `lme`）、`start_date`、`end_date`（`YYYY-MM-DD`，可为空）。
  - 返回：`DailyRecord[]`，按日期逆序；`meta` 附带筛选条件。

**字段说明（节选）**（完整定义参见 `backend/src/api/models.py`）
- `latest_price/open/high/low/close/settlement`：浮点数，若缺失返回 `null`。
- `change`：涨跌额；`change_pct`：涨跌幅百分比（原始值即百分数）。
- `elapsed_seconds`：从采集开始到当前条目的耗时（秒）。
- `tick_time`（Intraday）：原始行情时间戳字符串。

- 分页：`intraday` 通过 `limit` 控制，`daily` 当前无分页；已决定 MVP 先展示最近 N 条并在前端提供轻量列表视图（表格与图表结合），后续再评估是否需要后端分页或虚拟滚动。

**补充：**

- 交易所枚举：当前确认 MVP 仅覆盖 `lme` / `shfe`，后续如扩展需同步更新接口与前端枚举。
- 日期格式：FastAPI 接受字符串，前端需按 ISO（yyyy-mm-dd）传参。
- SSE：后端暂无推送接口，MVP 采用基于 `/health.intraday_interval_seconds` 的轮询刷新；视后续需求再升级为 SSE。

## 阶段 3：信息架构与线框准备（草案）

**页面范围**
- MVP 仅包含一个首页大屏视图，无额外导航或多页面结构。

**信息块清单**
- 服务状态条：展示系统时间、最新抓取时间、健康状态。
- 关键指标卡：最新价、涨跌额/幅、昨结、成交量、持仓量等核心指标，按语义配色显示涨跌。
- 分时行情图：基于 `/api/v1/dashboard/latest` + `/intraday` 的主折线/面积图，突出实时价格与成交量。
- 日线趋势图：使用 `/daily` 数据展示历史走势，可按日期范围筛选。
- 实时明细表：列出最近 N 条成交/报价记录（时间、价格、涨跌、成交量等），作为图表的精确补充。
- 辅助信息区：异常提示、无数据占位、刷新提示等状态反馈。

**布局草案说明**
- 顶部横条：放置服务状态条与系统标题，保证用户第一眼看到刷新状态。
- 左侧窄栏：预留交易所/合约切换（默认 LME/SHFE），并展示当前选中项。
- 中心主区：上层为分时行情图，下层可并排放置 LME/SHFE 对比图与日线趋势图，确保趋势信息一屏可见。
- 右侧指标列：垂直排列关键指标卡，提供即时数值与环比/前值对比。
- 底部横栏：放置实时明细表，默认展示最近 N 条记录，可折叠/展开以节省空间。
- 状态提示：在右上角或底部角落加入轮询倒计时、错误提示等轻量反馈。

**交互与状态**
- 数据刷新：按轮询间隔更新主图、指标与表格，刷新时在状态条显示 loading 或轻微闪烁提示。
- 空/错状态：无数据时在图表/表格区域显示占位文案，并在状态条给出可操作提示。
- 多语言/主题：MVP 默认中文与亮色主题，后续如需扩展再在设计系统中补充。

> 下一步：据此绘制首页大屏的低保真线框，并梳理各组件依赖的数据接口与状态。

## 设计需要产出（详单）
- 设计令牌：主/辅色、语义色（信息/成功/警告/错误）、文字层级、间距刻度、圆角/阴影梯度；是否支持暗色模式。
- 基础组件：按钮、输入、选择、日期时间、表单校验、Modal/Drawer、表格、分页、步骤条、通知/消息。
- 模板与版式：列表页、详情页、表单页、仪表盘、设置页。
- 状态规范：加载骨架、空状态、错误提示、权限受限、表单校验反馈（字段级/全局级）。
- 交互与可用性：焦点顺序、键盘操作、可聚焦状态、语义标签、对比度达标。
- 响应式：断点（1440/1280/768/375）、栅格/容器布局、触屏差异。
- 文案与语气：标题层级、按钮/提示文案、多语言策略（如需）。

## 技术选型
**框架**：Vue 3（Composition API, `<script setup>`）

**语言**：TypeScript（保证类型安全与长期可维护）

**构建**：Vite（开发快、配置直观）

**UI 组件库**：Ant Design Vue（企业级组件齐全、中文资料多）

**可视化**：ECharts（大屏/时序/地图/仪表盘都强）；

**HTTP 客户端**：Axios（拦截器、统一错误处理）

**路由**：Vue Router（分模块、权限守卫）

**国际化/本地化**：vue-i18n（中英文切换可选）

**打包与包管理**：pnpm（更快更省空间）

**质量与规范**：ESLint + Prettier + Husky + lint-staged

## 目录与路由约定（示例，React）
- src/app：应用入口、主题、全局错误边界、Provider 注册
- src/pages：路由页面（每页一个目录，集中路由）
- src/features：业务模块（含组件、hooks、api 封装、types）
- src/components：跨模块可复用组件
- src/entities：领域实体与类型定义（与后端契约对齐）
- src/shared：工具函数、常量、设计令牌、样式、权限工具

## 状态与请求规范
- 鉴权：HttpOnly Cookie 优先；刷新/过期策略；路由守卫与受保护页面。
- React Query：查询/变更键规范、cacheTime/staleTime、错误重试、乐观更新。
- API 封装：统一 fetch/axios 实例（baseURL、超时、拦截器、错误映射）。
- 错误处理：网络/权限/业务错误统一处理，错误码→用户提示映射表。
- 加载策略：骨架屏优先，避免全局菊花；细粒度占位与并发策略。
- 表单校验：Zod 模式定义，后端错误回填字段级提示。

## 质量与性能基线
- 可访问性：Tab 可达、aria 属性、键盘可操作、对比度达标（WCAG AA）。
- 响应式：适配 1440/1280/768/375 四档，触屏交互优化。
- 性能预算：LCP < 2.5s（关键路径）、CLS < 0.1、JS 首包 < 200KB（MVP）。
- 国际化（可选）：react-i18next，文案抽取与语言包管理。
- 监控：基础埋点（PV/UV/关键事件）、前端错误上报（Sentry/自建）。

## MVP 页面清单样例（按通用 SaaS，可替换为领域页面）
- 登录/注册/忘记密码
- 仪表盘（核心指标/快捷入口）
- 实体列表（筛选/分页/导出）
- 实体详情（主信息/子表/操作）
- 创建/编辑表单（草稿/校验）
- 设置（账号/团队/权限/令牌）
- 系统状态（通知/日志/帮助）

## 迭代节奏（10 天样例）
- D1–D2：需求澄清、用户流程、站点地图
- D3：线框（核心流）与评审
- D4：设计令牌与组件基线
- D5：搭建脚手架与 CI
- D6–D8：实现核心页面并打通接口
- D9：响应式/可访问性/性能打磨
- D10：部署、文档与交接

## 验收标准（DoD）
- 闭环流可用（含异常路径）且与后端契约一致
- 响应式良好、可访问性基础达标、性能预算通过
- 接口错误可被感知并有可行动反馈
- 具备最小化监控与问题定位手段
- 有快速上手文档与运行脚本

## 需要确认的信息（请按可用程度补充）
- 产品：目标用户与核心用例（前三个闭环）
- 视觉：品牌色/Logo/风格偏好/是否需要暗色
- 设备：桌面/移动/Pad 占比、最低浏览器要求
- 国际化：是否需要多语言
- 权限：角色模型、未授权时的期望行为
- 后端：接口文档/Swagger 地址、鉴权方案、分页/排序/搜索约定
- 功能点：文件上传、实时能力（WebSocket）、导入导出
- 部署：目标环境（内网/云端）、域名/HTTPS、CDN
- 埋点：关键事件清单与指标口径

## 下一步（建议）
1) 我扫描后端接口与实体（如有 Swagger/OpenAPI），生成接口清单与实体类型草案。
2) 基于接口清单，给出站点地图与核心流程线框图（低保真）。
3) 你确认后，我搭建脚手架与基础页面骨架，落地设计令牌与基础组件。

---

变更记录
- v0.1：首次草案，待按实际后端与业务域修订。
